services:
  backend:
    build:
      context: ./backend
      dockerfile: Dockerfile
    container_name: ncafe-backend
    ports:
      - "8081:8081"
    volumes:
      - /home/newlec/dist/ncafe/upload:/app/upload
    environment:
      - SPRING_PROFILES_ACTIVE=prod
      # If you want to override DB connection string, you can do it here:
      # - SPRING_DATASOURCE_URL=jdbc:postgresql://host.docker.internal:5432/ncafedb
    restart: unless-stopped

  frontend:
    build:
      context: ./frontend
      dockerfile: Dockerfile
    container_name: ncafe-frontend
    ports:
      - "3001:3001"
    environment:
      # This URL is used by the Next.js server for API rewrites/SSR
      - NEXT_PUBLIC_API_URL=http://backend:8081
    depends_on:
      - backend
    restart: unless-stopped
